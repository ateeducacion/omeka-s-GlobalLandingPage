<?php
/**
 * @var Laminas\View\Renderer\PhpRenderer $this
 */

$navItems = [];
if (isset($this->navItems) && is_iterable($this->navItems)) {
    foreach ($this->navItems as $item) {
        if (!is_array($item)) {
            continue;
        }
        $label = isset($item['label']) ? (string) $item['label'] : '';
        $url = isset($item['url']) ? (string) $item['url'] : '';
        if ($label === '' || $url === '') {
            continue;
        }
        $navItems[] = [
            'label' => $label,
            'url' => $url,
            'active' => !empty($item['active']),
        ];
    }
}
if ($navItems === []) {
    $navItems = [
        ['label' => $this->translate('Home'), 'url' => '#hero', 'active' => true],
        ['label' => $this->translate('Collections'), 'url' => '#collections', 'active' => false],
        ['label' => $this->translate('About'), 'url' => '#about', 'active' => false],
        ['label' => $this->translate('Contact'), 'url' => '#contact', 'active' => false],
    ];
}

$headerModifier = trim((string) ($this->headerModifier ?? 'main-header--inline'));
$siteTitle = isset($this->siteTitle) ? (string) $this->siteTitle : $this->translate('Global Landing Page');
$siteSubtitle = isset($this->siteSubtitle) ? (string) $this->siteSubtitle : $this->translate('Repositorio de medios audiovisuales educativos.');
$sitesLogos = $this->sitesLogos ?? null;
$homeAnchor = '#hero';
$logoHtml = '';

if (is_iterable($sitesLogos)) {
    $logoFragments = [];
    foreach ($sitesLogos as $logo) {
        if (is_array($logo)) {
            $src = isset($logo['src']) ? (string) $logo['src'] : '';
            if ($src === '') {
                continue;
            }
            $alt = isset($logo['alt']) ? (string) $logo['alt'] : $siteTitle;
        } elseif (is_string($logo)) {
            $src = $logo;
            if ($src === '') {
                continue;
            }
            $alt = $siteTitle;
        } else {
            continue;
        }

        $logoFragments[] = sprintf(
            '<img src="%s" alt="%s">',
            $this->escapeHtmlAttr($src),
            $this->escapeHtmlAttr($alt !== '' ? $alt : $siteTitle)
        );
    }

    if ($logoFragments !== []) {
        $logoHtml = implode("\n", $logoFragments);
    }
} elseif (is_string($sitesLogos) && $sitesLogos !== '') {
    $logoHtml = sprintf(
        '<img src="%s" alt="%s">',
        $this->escapeHtmlAttr($sitesLogos),
        $this->escapeHtmlAttr($siteTitle)
    );
}

$this->inlineScript()->appendScript(sprintf(
    'window.closeText = %s; window.previousText = %s;',
    json_encode($this->translate('Close menu')),
    json_encode($this->translate('Back'))
));
?>
<header class="main-header <?= $this->escapeHtmlAttr($headerModifier); ?>" role="banner">
    <div class="main-header__top-bar container">
            <div class="main-header__advanced-search">
                <a class="link-style" href="#advanced-search">
                    <?= $this->translate('Advanced search'); ?>
                </a>
            </div>
            <div class="main-header__search-form">
                <?= $this->partial(
                    'common/cross-site-search/fulltext-form.phtml',
                    ['action' => $this->url('search', ['action' => 'results'], true)]
                ); ?>
            </div>
    </div>
    <hr>
    <div class="main-header__main-bar container">
        <div class="main-header__site-title">
            <a href="<?= $this->escapeHtmlAttr($homeAnchor); ?>">
                <?php if ($logoHtml !== ''): ?>
                    <?= $logoHtml; ?>
                <?php else: ?>
                    <?= $this->escapeHtml($siteTitle); ?>
                <?php endif; ?>
            </a>
            <?php if ($siteSubtitle !== ''): ?>
                <p>
                    <?= $this->escapeHtml($siteSubtitle); ?>
                </p>
            <?php endif; ?>
        </div>
        <nav class="main-navigation" aria-label="<?= $this->translate('Primary navigation'); ?>">
            <button
                type="button"
                class="main-navigation__toggle"
                aria-expanded="false"
                aria-controls="primary-navigation menu-drawer"
            >
                <span></span>
                <span></span>
                <span></span>
                <span class="screen-reader-text"><?= $this->translate('Toggle navigation'); ?></span>
            </button>
            <div class="main-navigation__container" id="primary-navigation">
                <ul class="navigation">
                    <?php foreach ($navItems as $navItem): ?>
                        <li class="<?= $navItem['active'] ? 'active' : ''; ?>">
                            <a
                                href="<?= $this->escapeHtmlAttr($navItem['url']); ?>"
                                <?= $navItem['active'] ? 'aria-current="page"' : ''; ?>
                            >
                                <?= $this->escapeHtml($navItem['label']); ?>
                            </a>
                        </li>
                    <?php endforeach; ?>
                </ul>
            </div>
        </nav>
    </div>
</header>
