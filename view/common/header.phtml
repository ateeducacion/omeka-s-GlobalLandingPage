<?php
/**
 * @var Laminas\View\Renderer\PhpRenderer $this
 */

$navItems = [];
$rawNavItems = $this->navItems ?? [];
if (is_iterable($rawNavItems)) {
    foreach ($rawNavItems as $item) {
        if (!is_array($item)) {
            continue;
        }
        $label = isset($item['label']) ? (string) $item['label'] : '';
        $url = isset($item['url']) ? (string) $item['url'] : '';
        if ($label === '' || $url === '') {
            continue;
        }
        $navItems[] = [
            'label' => $label,
            'url' => $url,
            'active' => !empty($item['active']),
        ];
    }
}

if ($navItems === []) {
    $navItems = [
        [
            'label' => $this->translate('Inicio'),
            'url' => $this->url('globallandingpage', [], true),
            'active' => true,
        ],
        [
            'label' => $this->translate('Explorar Canales'),
            'url' => $this->url('globallandingpage-sites', [], true),
            'active' => false,
        ],
    ];
}

$headerModifier = trim((string) ($this->headerModifier ?? 'main-header--inline'));
$siteTitle = isset($this->siteTitle) ? (string) $this->siteTitle : $this->translate('Global Landing Page');
$siteSubtitle = isset($this->siteSubtitle) ? (string) $this->siteSubtitle : $this->translate('Repositorio de medios audiovisuales educativos.');
$homeAnchor = $this->url('globallandingpage', [], true);
$showTopBar = isset($this->showTopBar) ? (bool) $this->showTopBar : true;

$logoEntries = [];
$rawLogos = $this->sitesLogos ?? [];
if (is_iterable($rawLogos)) {
    foreach ($rawLogos as $logo) {
        $source = '';
        $alt = $siteTitle;
        if (is_array($logo)) {
            $source = isset($logo['src']) ? (string) $logo['src'] : '';
            if (isset($logo['alt']) && $logo['alt'] !== '') {
                $alt = (string) $logo['alt'];
            }
        } elseif (is_string($logo)) {
            $source = $logo;
        }

        if ($source === '') {
            continue;
        }

        if (
            !preg_match('~^(?:https?:)?//~i', $source)
        ) {
            $source = $this->assetUrl('img/' . basename($source), 'GlobalLandingPage');
        }

        $logoEntries[] = [
            'src' => $source,
            'alt' => $alt !== '' ? $alt : $siteTitle,
        ];
    }
}

$topBarLogoEntry = null;
$rawTopBarLogo = $this->topBarLogo ?? null;
if (is_array($rawTopBarLogo)) {
    $topBarSrc = isset($rawTopBarLogo['src']) ? (string) $rawTopBarLogo['src'] : '';
    if ($topBarSrc !== '') {
        $topBarAlt = isset($rawTopBarLogo['alt']) && $rawTopBarLogo['alt'] !== ''
            ? (string) $rawTopBarLogo['alt']
            : $siteTitle;
        $topBarLogoEntry = [
            'src' => $topBarSrc,
            'alt' => $topBarAlt,
        ];
    }
} elseif (is_string($rawTopBarLogo) && $rawTopBarLogo !== '') {
    $topBarLogoEntry = [
        'src' => $rawTopBarLogo,
        'alt' => $siteTitle,
    ];
}

$this->inlineScript()->appendScript(sprintf(
    'window.closeText = %s; window.previousText = %s;',
    json_encode($this->translate('Close menu')),
    json_encode($this->translate('Back'))
));
?>
<header class="main-header <?= $this->escapeHtmlAttr($headerModifier); ?>" role="banner">
    <?php if ($showTopBar): ?>
        <div class="main-header__top-bar container">
            <?php if ($topBarLogoEntry): ?>
                <div class="main-header__top-bar-logo">
                    <img
                        src="<?= $this->escapeHtmlAttr($topBarLogoEntry['src']); ?>"
                        alt="<?= $this->escapeHtmlAttr($topBarLogoEntry['alt']); ?>"
                        loading="lazy"
                    >
                </div>
            <?php endif; ?>
            <div class="main-header__search-form">
                <?= $this->partial(
                    'common/cross-site-search/fulltext-form.phtml',
                    ['action' => $this->url('search', ['action' => 'results'], true)]
                ); ?>
            </div>
        </div>
        <hr>
    <?php endif; ?>
    <div class="main-header__main-bar container">
        <div class="main-header__site-title">
            <a href="<?= $this->escapeHtmlAttr($homeAnchor); ?>">
                <?php if ($logoEntries !== []): ?>
                    <?php foreach ($logoEntries as $logo): ?>
                        <img
                            src="<?= $this->escapeHtmlAttr($logo['src']); ?>"
                            alt="<?= $this->escapeHtmlAttr($logo['alt']); ?>"
                        >
                    <?php endforeach; ?>
                <?php else: ?>
                    <?= $this->escapeHtml($siteTitle); ?>
                <?php endif; ?>
            </a>
            <?php if ($siteSubtitle !== ''): ?>
                <p>
                    <?= $this->escapeHtml($siteSubtitle); ?>
                </p>
            <?php endif; ?>
        </div>
        <nav class="main-navigation" aria-label="<?= $this->translate('Primary navigation'); ?>">
            <button
                type="button"
                class="main-navigation__toggle"
                aria-expanded="false"
                aria-controls="primary-navigation menu-drawer"
            >
                <span></span>
                <span></span>
                <span></span>
                <span class="screen-reader-text"><?= $this->translate('Toggle navigation'); ?></span>
            </button>
            <div class="main-navigation__container" id="primary-navigation">
                <ul class="navigation">
                    <?php foreach ($navItems as $navItem): ?>
                        <li class="<?= $navItem['active'] ? 'active' : ''; ?>">
                            <a
                                href="<?= $this->escapeHtmlAttr($navItem['url']); ?>"
                                <?= $navItem['active'] ? 'aria-current="page"' : ''; ?>
                            >
                                <?= $this->escapeHtml($navItem['label']); ?>
                            </a>
                        </li>
                    <?php endforeach; ?>
                </ul>
            </div>
        </nav>
    </div>
</header>
