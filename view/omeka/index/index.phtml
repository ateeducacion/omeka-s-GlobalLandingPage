<?php
/**
 * @var Laminas\View\Renderer\PhpRenderer $this
 * @var string|null $headline
 * @var string|null $lead
 * @var string|null $primaryActionLabel
 * @var string|null $primaryActionUrl
 */

$headline = $this->headline ?? $this->translate('Servicio Mediateca'); // @translate
$lead = $this->lead ?? $this->translate('Repositorio de medios audiovisuales educativos.'); // @translate
$primaryActionLabel = $this->primaryActionLabel ?? $this->translate('Browse Collections'); // @translate
$primaryActionUrl = $this->primaryActionUrl ?? '#collections';
$siteLogo=$this->assetUrl('img/logo-mediateca.svg', 'GlobalLandingPage');
$heroImage = $this->heroImage ?? null;

$layout = $this->layout();
if ($layout) {
    $layout->setVariable('siteTitle', $headline);
    $layout->setVariable('siteSubtitle', $lead);
    $layout->setVariable('siteLogo', $siteLogo);
    $layout->setVariable('headerNavigation', [
        ['label' => $this->translate('Home'), 'url' => '#hero', 'active' => true],
        ['label' => $this->translate('Collections'), 'url' => '#collections', 'active' => false],
        ['label' => $this->translate('About'), 'url' => '#about', 'active' => false],
        ['label' => $this->translate('Contact'), 'url' => '#contact', 'active' => false],
    ]);
}

$sites = [];
try {
    $response = $this->api()->search('sites', [
        'site_status' => 'public',
        'sort_by' => 'o:title',
        'sort_order' => 'asc',
        'limit' => 6,
    ]);
    $sites = $response->getContent();
} catch (\Exception $exception) {
    $sites = [];
}
?>


<section class="container" id="collections" aria-labelledby="collections-heading">
    <h2 id="collections-heading">
        <?= $this->translate('Featured Omeka S sites'); ?>
    </h2>
    <p>
        <?= $this->translate('Browse recent or highlighted sites across your Omeka S installation.'); ?>
    </p>
    <div class="list-of-sites" role="list">
        <?php if ($sites): ?>
            <?php foreach ($sites as $site): ?>
                <?php
                $siteSlug = method_exists($site, 'slug') ? $site->slug() : (is_array($site) ? ($site['o:slug'] ?? null) : null);
                $siteUrl = method_exists($site, 'siteUrl')
                    ? $site->siteUrl()
                    : ($siteSlug ? $this->url('site', ['site-slug' => $siteSlug]) : '#');
                $siteTitle = method_exists($site, 'title')
                    ? $site->title()
                    : (is_array($site) ? ($site['o:title'] ?? '') : '');
                $thumbnailUrl = method_exists($site, 'thumbnailDisplayUrl')
                    ? $site->thumbnailDisplayUrl('square')
                    : null;
                $summary = method_exists($site, 'summary')
                    ? (string) $site->summary()
                    : (is_array($site) ? ($site['o:summary'] ?? '') : '');
                ?>
                <article class="site" role="listitem">
                    <a href="<?= $this->escapeHtmlAttr($siteUrl); ?>">
                        <?php if ($thumbnailUrl): ?>
                            <div class="site-thumbnail-image">
                                <img
                                    src="<?= $this->escapeHtmlAttr($thumbnailUrl); ?>"
                                    alt="<?= $this->escapeHtmlAttr($siteTitle); ?>"
                                >
                            </div>
                        <?php endif; ?>
                        <div>
                            <h3><?= $this->escapeHtml($siteTitle); ?></h3>
                            <?php if ($summary !== ''): ?>
                                <p><?= $this->escapeHtml($summary); ?></p>
                            <?php endif; ?>
                        </div>
                    </a>
                </article>
            <?php endforeach; ?>
        <?php else: ?>
            <p>
                <?= $this->translate('No public sites are available yet.'); ?>
            </p>
        <?php endif; ?>
    </div>
</section>

<section class="container regions-container" aria-labelledby="about-heading">
    <div class="main-region" id="about">
        <h2 id="about-heading">
            <?= $this->translate('About this archive'); ?>
        </h2>
        <p>
            <?= $this->translate('Share provenance, curatorial goals, and collecting scopes so visitors understand the breadth of your holdings.'); ?>
        </p>
        <div class="resource-list">
            <article class="resource">
                <div class="resource__content">
                    <h3><?= $this->translate('Curated exhibits'); ?></h3>
                    <p><?= $this->translate('Introduce highlighted exhibits or thematic tours connected to your strongest narratives.'); ?></p>
                </div>
            </article>
            <article class="resource">
                <div class="resource__content">
                    <h3><?= $this->translate('Powerful discovery'); ?></h3>
                    <p><?= $this->translate('Surface items, item sets, and media with the built-in search tools and flexible advanced filters.'); ?></p>
                </div>
            </article>
            <article class="resource">
                <div class="resource__content">
                    <h3><?= $this->translate('Flexible building blocks'); ?></h3>
                    <p><?= $this->translate('Combine reusable sections to craft hero banners, feature grids, and calls to action without leaving Omeka S.'); ?></p>
                </div>
            </article>
        </div>
    </div>
    <aside class="sidebar-region sidebar-region--right" id="contact" aria-labelledby="contact-heading">
        <h2 id="contact-heading">
            <?= $this->translate('Stay connected'); ?>
        </h2>
        <p>
            <?= $this->translate('Provide a way for visitors to follow updates or reach the team behind the collection.'); ?>
        </p>
        <ul>
            <li>
                <a href="mailto:info@example.org">info@example.org</a>
            </li>
            <li>
                <a href="#">
                    <?= $this->translate('Follow on social media'); ?>
                </a>
            </li>
        </ul>
    </aside>
</section>
