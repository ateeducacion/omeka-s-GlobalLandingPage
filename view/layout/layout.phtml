<?php
/**
 * @var Laminas\View\Renderer\PhpRenderer $this
 */

$this->doctype(\Laminas\View\Helper\Doctype::HTML5);

$translate = $this->plugin('translate');
$translator = method_exists($translate, 'getTranslator') ? $translate->getTranslator() : null;
$lang = 'en';
if ($translator && method_exists($translator, 'getLocale')) {
    $lang = (string) $translator->getLocale();
} elseif (class_exists(\Locale::class)) {
    $lang = (string) \Locale::getDefault();
}

$this->headTitle($this->translate('Global Landing Page')); // @translate
$this->headLink()->prependStylesheet($this->assetUrl('css/iconfonts.css', 'Omeka'));
$this->headLink()->prependStylesheet('https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400;1,600;1,700&display=swap');
$this->headLink()->prependStylesheet('https://fonts.googleapis.com/css2?family=Noto+Serif:ital,wght@0,400;0,700;1,400;1,700&display=swap');
$this->headScript()->prependFile($this->assetUrl('js/global.js', 'Omeka'));
$this->headScript()->prependFile($this->assetUrl('vendor/jquery/jquery.min.js', 'Omeka'));
$this->headLink()->appendStylesheet($this->assetUrl('css/style.css', 'GlobalLandingPage'));
$this->headScript()->appendFile($this->assetUrl('js/navigation.js', 'GlobalLandingPage'));
$this->headScript()->appendFile($this->assetUrl('js/script.js', 'GlobalLandingPage'));

$primaryColor = $this->setting(
    \GlobalLandingPage\Module::SETTING_PRIMARY_COLOR,
    \GlobalLandingPage\Module::DEFAULT_COLORS[\GlobalLandingPage\Module::SETTING_PRIMARY_COLOR]
);
$secondaryColor = $this->setting(
    \GlobalLandingPage\Module::SETTING_SECONDARY_COLOR,
    \GlobalLandingPage\Module::DEFAULT_COLORS[\GlobalLandingPage\Module::SETTING_SECONDARY_COLOR]
);
$accentColor = $this->setting(
    \GlobalLandingPage\Module::SETTING_ACCENT_COLOR,
    \GlobalLandingPage\Module::DEFAULT_COLORS[\GlobalLandingPage\Module::SETTING_ACCENT_COLOR]
);

if (!is_string($primaryColor) || $primaryColor === '') {
    $primaryColor = \GlobalLandingPage\Module::DEFAULT_COLORS[\GlobalLandingPage\Module::SETTING_PRIMARY_COLOR];
}

if (!is_string($secondaryColor) || $secondaryColor === '') {
    $secondaryColor = \GlobalLandingPage\Module::DEFAULT_COLORS[\GlobalLandingPage\Module::SETTING_SECONDARY_COLOR];
}

if (!is_string($accentColor) || $accentColor === '') {
    $accentColor = \GlobalLandingPage\Module::DEFAULT_COLORS[\GlobalLandingPage\Module::SETTING_ACCENT_COLOR];
}

$footerHtml = $this->setting(\GlobalLandingPage\Module::SETTING_FOOTER_HTML, '');
if (!is_string($footerHtml)) {
    $footerHtml = '';
}

$headerModifier = (string) ($this->headerModifier ?? 'main-header--inline');
$bodyClass = trim(sprintf(
    '%s %s',
    $headerModifier,
    isset($this->bodyClass) ? (string) $this->bodyClass : ''
));

$landingConfig = $this->landingPageConfig();
$headline = isset($landingConfig['headline']) && is_string($landingConfig['headline'])
    ? $landingConfig['headline']
    : $this->translate('Servicio Mediateca');
$lead = isset($landingConfig['lead']) && is_string($landingConfig['lead'])
    ? $landingConfig['lead']
    : $this->translate('Repositorio de medios audiovisuales educativos.');
$sitesLogosFromConfig = isset($landingConfig['sitesLogos']) && is_iterable($landingConfig['sitesLogos'])
    ? $landingConfig['sitesLogos']
    : [];
$navItemsFromConfig = isset($landingConfig['navItems']) && is_iterable($landingConfig['navItems'])
    ? $landingConfig['navItems']
    : [];
$topBarConfig = isset($landingConfig['topBar']) && is_array($landingConfig['topBar'])
    ? $landingConfig['topBar']
    : [];

$activeNav = isset($this->activeNav) ? (string) $this->activeNav : 'home';
$navItems = [];
foreach ($navItemsFromConfig as $item) {
    if (!is_array($item)) {
        continue;
    }
    $label = isset($item['label']) ? (string) $item['label'] : '';
    $url = isset($item['url']) ? (string) $item['url'] : '';
    if ($label === '' || $url === '') {
        continue;
    }
    $slug = isset($item['slug']) ? (string) $item['slug'] : '';
    $navItems[] = [
        'label' => $label,
        'url' => $url,
        'active' => $slug === $activeNav,
    ];
}
if ($navItems === []) {
    $navItems = [
        [
            'label' => $this->translate('Inicio'),
            'url' => $this->url('globallandingpage', [], true),
            'active' => $activeNav === 'home',
        ],
        [
            'label' => $this->translate('Explorar Canales'),
            'url' => $this->url('globallandingpage-sites', [], true),
            'active' => $activeNav === 'explore',
        ],
    ];
}

$siteTitle = isset($this->siteTitle) ? (string) $this->siteTitle : $headline;
$siteSubtitle = isset($this->siteSubtitle) ? (string) $this->siteSubtitle : $lead;
$sitesLogos = $this->sitesLogos ?? $sitesLogosFromConfig;
$showTopBar = isset($this->showTopBar)
    ? (bool) $this->showTopBar
    : (isset($topBarConfig['show']) ? (bool) $topBarConfig['show'] : true);
$topBarLogo = isset($this->topBarLogo) ? $this->topBarLogo : ($topBarConfig['logo'] ?? null);

$layout = $this->layout();
if ($layout) {
    $layout->setVariable('landingConfig', $landingConfig);
    $layout->setVariable('headline', $headline);
    $layout->setVariable('lead', $lead);
    $layout->setVariable('sitesLogos', $sitesLogos);
    $layout->setVariable('navItems', $navItems);
    $layout->setVariable('showTopBar', $showTopBar);
    $layout->setVariable('topBarLogo', $topBarLogo);
    if (isset($landingConfig['featuredSites']) && is_array($landingConfig['featuredSites'])) {
        $layout->setVariable('featuredSites', $landingConfig['featuredSites']);
    }
}
?>
<?= $this->doctype(); ?>
<html lang="<?= $this->escapeHtmlAttr($lang); ?>">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <?= $this->headTitle(); ?>
    <?= $this->headMeta(); ?>
    <?= $this->headLink(); ?>
    <?= $this->headScript(); ?>
    <style type="text/css" media="screen">
        :root {
            --primary: <?php echo $primaryColor; ?>;
            --primary-dark: <?php echo $this->ShadeColor($primaryColor, -10); ?>;
            --primary-contrast: <?php echo $this->ContrastColor($primaryColor, ['#fff', '#333']); ?>;
            --secondary: <?php echo $secondaryColor; ?>;
            --secondary-dark: <?php echo $this->ShadeColor($secondaryColor, -10); ?>;
            --secondary-contrast: <?php echo $this->ContrastColor($secondaryColor, ['#fff', '#333']); ?>;
            --accent: <?php echo $accentColor; ?>;
            --accent-dark: <?php echo $this->ShadeColor($accentColor, -10); ?>;
        }
    </style>
</head>
<body class="<?= $this->escapeHtmlAttr($bodyClass); ?>">

    <?= $this->partial('global-landing-page/common/header', [
        'navItems' => $navItems,
        'siteTitle' => $siteTitle,
        'siteSubtitle' => $siteSubtitle,
        'sitesLogos' => $sitesLogos,
        'headerModifier' => $headerModifier,
        'showTopBar' => $showTopBar,
        'topBarLogo' => $topBarLogo,
    ]); ?>

    <div id="menu-drawer" class="menu-drawer" aria-hidden="true" inert>
        <div class="wrap">
            <div class="navigation-controls">
                <a href="#" id="menu-backer" role="button" aria-live="polite">
                    <?= $this->translate('Close menu'); ?>
                </a>
            </div>
            <div id="menu-clones" class="menu-container" aria-hidden="true"></div>
        </div>
    </div>

    <main id="main-content" class="site-main" role="main">
        <?= $this->content; ?>
    </main>

    <?php if ($footerHtml == ''): ?>
        <?= $this->partial('global-landing-page/common/footer',[
            'footerHtml'=> 'Global landing page footer' // @translate
        ]); ?>
    <?php else: ?>
        <?= $this->partial('global-landing-page/common/footer',[
            'footerHtml'=> $footerHtml
        ]); ?>
    <?php endif; ?>

    <?= $this->inlineScript(); ?>
</body>
</html>
